<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculateur de moyennes</title>
  <style>
    :root{
      --bg1:#071a2b;
      --bg2:#0b2f52;
      --card:#ffffff;
      --line:rgba(10,55,96,.18);
      --text:#0b1220;
      --muted:#4b5563;
      --primary:#0b5ed7;
      --primary2:#40a9ff;
      --ok:#0f766e;
      --warn:#b45309;
      --bad:#b00020;
      --shadow: 0 14px 40px rgba(0,0,0,.18);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(64,169,255,.35), transparent 60%),
        radial-gradient(900px 520px at 90% 20%, rgba(11,94,215,.35), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding: 18px 12px 40px;
    }
    .wrap{ max-width: 980px; margin: 0 auto; }
    .hero{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      color:#eaf2ff; padding: 18px 18px 8px;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width: 220px; }
    .logo{
      width:46px;height:46px;border-radius:14px;
      background: linear-gradient(135deg, var(--primary2), var(--primary));
      box-shadow: 0 10px 25px rgba(64,169,255,.25);
      display:grid;place-items:center;
      font-weight:1000; color:#06223a;
    }
    h1{ margin:0; font-size: 20px; letter-spacing: .2px; }
    .subtitle{ margin:2px 0 0; opacity:.85; font-size: 13px; }
    .pill{
      display:flex; gap:8px; align-items:center;
      padding: 10px 12px; border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(8px);
      font-size: 13px; white-space: nowrap;
    }
    .pill b{ color:#fff; }

    /* Tabs */
    .tabs{
      display:flex; gap:10px; flex-wrap:wrap;
      padding: 0 18px 14px;
    }
    .tab{
      position: relative;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#eaf2ff;
      padding: 10px 12px;
      padding-right: 62px; /* place mascotte */
      border-radius: 999px;
      cursor:pointer;
      font-weight:900;
      font-size: 13px;
      user-select:none;
      overflow: visible;
    }
    .tab.active{
      background: linear-gradient(135deg, rgba(64,169,255,.55), rgba(11,94,215,.35));
      border-color: rgba(64,169,255,.65);
    }

    /* Mascottes */
    .mascot{
      position:absolute;
      right:-6px;
      top:-18px;
      width:70px;
      height:50px;
      pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
      transform: rotate(-6deg);
      opacity:.95;
      transform-origin: 70% 80%;
    }
    @keyframes floaty {
      0%,100% { transform: rotate(-6deg) translateY(0); }
      50%     { transform: rotate(-6deg) translateY(-2px); }
    }
    @keyframes pop {
      0% { transform: translateY(6px) scale(.96); opacity:0; }
      100% { transform: translateY(0) scale(1); opacity:1; }
    }
    @keyframes bounce {
      0% { transform: rotate(-2deg) translateY(0); }
      35% { transform: rotate(-2deg) translateY(-4px); }
      100% { transform: rotate(-2deg) translateY(-1px); }
    }
    .tab .mascot{ animation: floaty 2.2s ease-in-out infinite; }
    .tab.active .mascot{ animation: bounce .35s ease-out 1; transform: rotate(-2deg) translateY(-1px); }

    /* Bulles */
    .bubble{
      position:absolute;
      right: 52px;
      top: -34px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(64,169,255,.35);
      color: #0b2f52;
      font-weight: 1000;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 12px 26px rgba(0,0,0,.18);
      display:none;
    }
    .bubble:after{
      content:"";
      position:absolute;
      right: 18px;
      bottom: -6px;
      width: 12px; height: 12px;
      background: rgba(255,255,255,.92);
      border-left: 1px solid rgba(64,169,255,.35);
      border-bottom: 1px solid rgba(64,169,255,.35);
      transform: rotate(45deg);
    }
    .tab.active .bubble{ display:block; animation: pop .18s ease-out 1; }

    /* Layout */
    .grid2{ display:grid; grid-template-columns: 1.15fr .85fr; gap: 14px; }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding: 14px 16px;
      background: linear-gradient(90deg, rgba(64,169,255,.18), rgba(11,94,215,.10));
      border-bottom: 1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .cardHead .title{ font-weight: 1000; font-size: 14px; color:#0b2f52; }
    .cardHead .hint{ font-size: 12px; color: var(--muted); }

    label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; font-weight: 800; }
    select, input{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(11,94,215,.18);
      outline: none;
      font-size: 15px;
      background: #fbfdff;
    }
    select:focus, input:focus{
      border-color: rgba(64,169,255,.95);
      box-shadow: 0 0 0 4px rgba(64,169,255,.18);
      background: #ffffff;
    }

    .controls{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 14px 16px 6px;
    }
    .starControls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 14px 16px 6px;
    }

    .rows{ padding: 8px 16px 2px; }
    .row{ display:grid; grid-template-columns: 1fr 1fr 92px; gap:10px; margin-bottom:10px; }
    .btnRow{ padding: 10px 16px 16px; display:flex; gap:10px; flex-wrap:wrap; }

    button{
      border:0;
      border-radius: 14px;
      padding: 11px 14px;
      font-size: 15px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .06s ease, filter .12s ease, opacity .12s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px); }
    .primary{
      color:#06223a;
      background: linear-gradient(135deg, var(--primary2), var(--primary));
      box-shadow: 0 10px 25px rgba(11,94,215,.20);
    }
    .ghost{ background: rgba(11,94,215,.08); color: #0b2f52; }
    .dangerBtn{ background: rgba(176,0,32,.08); color: var(--bad); font-weight: 1000; }
    .mini{ font-size: 13px; padding: 10px 12px; border-radius: 12px; }
    .del{
      background: rgba(11,94,215,.08);
      color:#0b2f52;
      border: 1px solid rgba(11,94,215,.14);
    }

    .side{ padding: 14px 16px 16px; }
    .result{ padding: 14px 16px; border-top: 1px solid var(--line); background: linear-gradient(180deg, rgba(64,169,255,.10), transparent); }
    .small{ font-size: 13px; color: var(--muted); line-height: 1.35; margin: 8px 0; }

    .kpi{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
      margin: 10px 0 6px;
    }
    .kpiBox{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: #ffffff;
    }
    .kpiBox .k{ font-size: 12px; color: var(--muted); margin-bottom: 4px; font-weight: 900; }
    .kpiBox .v{ font-size: 20px; font-weight: 1100; color:#0b2f52; }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px; border-radius: 999px;
      font-weight: 1000; font-size: 12px;
      border: 1px solid var(--line); background:#fff;
      margin-top: 4px;
    }
    .b-ok{ color: var(--ok); }
    .b-warn{ color: var(--warn); }
    .b-bad{ color: var(--bad); }

    .list{ margin: 10px 0 0; padding-left: 18px; color: #1f2937; }
    .list li{ margin: 6px 0; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: #061626;
      color: #d9ecff;
      border-radius: 14px;
      padding: 12px;
      border: 1px solid rgba(64,169,255,.22);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .starsLine{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      margin-top: 8px;
    }
    .stars{
      font-size: 20px;
      letter-spacing: 2px;
      background: linear-gradient(135deg, var(--primary2), var(--primary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 1000;
    }

    .section{ display:none; }
    .section.active{ display:block; }

    .footer{ margin-top: 14px; color: rgba(255,255,255,.70); text-align:center; font-size: 12px; }

    @media (max-width: 860px){
      .grid2{ grid-template-columns: 1fr; }
      .controls{ grid-template-columns: 1fr; }
      .starControls{ grid-template-columns: 1fr; }
      .kpi{ grid-template-columns: 1fr; }
      .pill{ display:none; }
    }
    @media (max-width: 520px){
      .bubble{ display:none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div class="logo">Œ£</div>
        <div>
          <h1>Calculateur de moyennes</h1>
          <div class="subtitle">Scolaire + Avis ‚≠ê (h√¥tel/site) ‚Ä¢ Sauvegarde automatique</div>
        </div>
      </div>
      <div class="pill"><b>Astuce</b> : dans ‚Äú√âtoiles‚Äù, utilise le nombre d‚Äôavis pour une moyenne pond√©r√©e.</div>
    </div>

    <div class="tabs">
      <div class="tab active" id="tabSchool">
        üéì Scolaire
        <span class="bubble">Je calcule ta moyenne üìö</span>

        <!-- Mascotte carnet -->
        <svg class="mascot" viewBox="0 0 140 100" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#40a9ff"/>
              <stop offset="1" stop-color="#0b5ed7"/>
            </linearGradient>
          </defs>
          <ellipse cx="78" cy="86" rx="48" ry="10" fill="rgba(0,0,0,.18)"/>
          <rect x="40" y="32" width="76" height="42" rx="10" fill="url(#g1)"/>
          <rect x="46" y="36" width="64" height="34" rx="8" fill="rgba(255,255,255,.15)"/>
          <rect x="40" y="32" width="10" height="42" rx="8" fill="rgba(255,255,255,.25)"/>
          <circle cx="70" cy="52" r="4" fill="#06223a"/>
          <circle cx="88" cy="52" r="4" fill="#06223a"/>
          <path d="M74 60 Q79 64 84 60" stroke="#06223a" stroke-width="3" fill="none" stroke-linecap="round"/>
          <path d="M36 56 Q28 56 24 64" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M118 56 Q128 56 134 64" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M66 74 Q62 82 54 84" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M96 74 Q100 82 108 84" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <rect x="18" y="70" width="28" height="10" rx="5" fill="#ffd166"/>
          <rect x="40" y="70" width="10" height="10" rx="3" fill="#ef476f"/>
          <path d="M18 70 L10 75 L18 80 Z" fill="#d6ccc2"/>
        </svg>
      </div>

      <div class="tab" id="tabStars">
        ‚≠ê √âtoiles (h√¥tel/site)
        <span class="bubble">On note √ßa ‚≠ê</span>

        <!-- Mascotte √©toile -->
        <svg class="mascot" viewBox="0 0 140 100" aria-hidden="true">
          <defs>
            <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#7dd3fc"/>
              <stop offset="1" stop-color="#1d4ed8"/>
            </linearGradient>
          </defs>
          <ellipse cx="78" cy="86" rx="46" ry="10" fill="rgba(0,0,0,.18)"/>
          <path d="M78 24
                   L87 44
                   L109 46
                   L92 60
                   L98 82
                   L78 70
                   L58 82
                   L64 60
                   L47 46
                   L69 44 Z"
                fill="url(#g2)"/>
          <circle cx="70" cy="54" r="4" fill="#06223a"/>
          <circle cx="86" cy="54" r="4" fill="#06223a"/>
          <path d="M72 62 Q78 67 84 62" stroke="#06223a" stroke-width="3" fill="none" stroke-linecap="round"/>
          <path d="M46 60 Q32 58 24 66" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M110 60 Q124 58 134 66" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M70 78 Q64 84 56 86" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
          <path d="M88 78 Q94 84 102 86" stroke="#0b2f52" stroke-width="8" stroke-linecap="round"/>
        </svg>
      </div>
    </div>

    <!-- SECTION SCOLAIRE -->
    <div class="section active" id="sectionSchool">
      <div class="grid2">
        <div class="card">
          <div class="cardHead">
            <div class="title">Entrer tes notes</div>
            <div class="hint">Une ligne = une note</div>
          </div>

          <div class="controls">
            <div>
              <label for="maxNote">Bar√®me</label>
              <select id="maxNote">
                <option value="20" selected>sur 20</option>
                <option value="10">sur 10</option>
                <option value="5">sur 5</option>
              </select>
            </div>

            <div>
              <label for="nextCoef">Coef prochain contr√¥le</label>
              <select id="nextCoef">
                <option>1</option><option selected>2</option><option>3</option><option>4</option><option>5</option><option>6</option>
              </select>
            </div>

            <div>
              <label for="target">Objectif de moyenne</label>
              <select id="target">
                <option value="10">10</option>
                <option value="12" selected>12</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
              </select>
            </div>
          </div>

          <div class="rows" id="rowsSchool"></div>

          <div class="btnRow">
            <button class="primary" id="calcSchool">Calculer</button>
            <button class="ghost" id="addSchool">+ Ajouter une note</button>
            <button class="ghost" id="exampleSchool">Exemple</button>
            <button class="dangerBtn" id="resetSchool">R√©initialiser</button>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <div class="title">R√©sultats</div>
            <div class="hint">Clairs et rapides</div>
          </div>

          <div class="side">
            <div class="small">
              Clique sur <b>Calculer</b> pour afficher ta moyenne, ton niveau, et la note √† viser au prochain contr√¥le.
            </div>

            <div id="statusBadgeSchool" class="badge b-warn" style="display:none;">Niveau</div>

            <div class="result" id="resultSchool" style="display:none;"></div>

            <div id="shareboxSchool" style="display:none; margin-top:12px;">
              <div class="small"><b>R√©sum√© √† copier</b></div>
              <div class="mono" id="sharetextSchool"></div>
              <button class="mini primary" id="copySchool" style="margin-top:10px;">Copier</button>
            </div>

            <div class="small" style="margin-top:14px;">
              Sauvegarde sur <b>ton appareil</b> (rien n‚Äôest envoy√©).
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION √âTOILES -->
    <div class="section" id="sectionStars">
      <div class="grid2">
        <div class="card">
          <div class="cardHead">
            <div class="title">Entrer des avis ‚≠ê</div>
            <div class="hint">Note 1‚Äì5 + nombre d‚Äôavis</div>
          </div>

          <div class="starControls">
            <div>
              <label for="starsMode">Mode</label>
              <select id="starsMode">
                <option value="weighted" selected>Moyenne pond√©r√©e (avec nb d‚Äôavis)</option>
                <option value="simple">Moyenne simple (ignore nb d‚Äôavis)</option>
              </select>
            </div>
            <div>
              <label for="starsScale">Afficher aussi en</label>
              <select id="starsScale">
                <option value="5" selected>/5</option>
                <option value="10">/10</option>
                <option value="20">/20</option>
              </select>
            </div>
          </div>

          <div class="rows" id="rowsStars"></div>

          <div class="btnRow">
            <button class="primary" id="calcStars">Calculer</button>
            <button class="ghost" id="addStars">+ Ajouter un avis</button>
            <button class="ghost" id="exampleStars">Exemple</button>
            <button class="dangerBtn" id="resetStars">R√©initialiser</button>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <div class="title">R√©sultat ‚≠ê</div>
            <div class="hint">Lisible tout de suite</div>
          </div>

          <div class="side">
            <div class="small">
              Mets une note sur 5 et, si tu veux, le <b>nombre d‚Äôavis</b> (ex : 4,6 ‚≠ê avec 120 avis).
            </div>

            <div id="statusBadgeStars" class="badge b-warn" style="display:none;">Qualit√©</div>

            <div class="result" id="resultStars" style="display:none;"></div>

            <div id="shareboxStars" style="display:none; margin-top:12px;">
              <div class="small"><b>R√©sum√© √† copier</b></div>
              <div class="mono" id="sharetextStars"></div>
              <button class="mini primary" id="copyStars" style="margin-top:10px;">Copier</button>
            </div>

            <div class="small" style="margin-top:14px;">
              Sauvegarde sur <b>ton appareil</b> (rien n‚Äôest envoy√©).
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">LeMiasck ‚Ä¢ GitHub Pages</div>
  </div>

  <script>
    const STORAGE_KEY = "calcul-moyenne-v5";
    const $ = (id) => document.getElementById(id);

    function round2(n){ return Math.round(n*100)/100; }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    // Tabs
    const tabSchool = $("tabSchool");
    const tabStars = $("tabStars");
    const sectionSchool = $("sectionSchool");
    const sectionStars = $("sectionStars");

    function setTab(which){
      const isSchool = which === "school";
      tabSchool.classList.toggle("active", isSchool);
      tabStars.classList.toggle("active", !isSchool);
      sectionSchool.classList.toggle("active", isSchool);
      sectionStars.classList.toggle("active", !isSchool);
      saveState();
    }
    tabSchool.onclick = () => setTab("school");
    tabStars.onclick = () => setTab("stars");

    // ---------- SCOLAIRE ----------
    const rowsSchool = $("rowsSchool");
    const resultSchool = $("resultSchool");
    const badgeSchool = $("statusBadgeSchool");
    const shareBoxSchool = $("shareboxSchool");
    const shareTextSchool = $("sharetextSchool");

    const maxNoteEl = $("maxNote");
    const nextCoefEl = $("nextCoef");
    const targetEl = $("target");

    function makeRowSchool(note="", coef="1"){
      const wrap = document.createElement("div");
      wrap.className = "row";

      const noteInput = document.createElement("input");
      noteInput.type="number"; noteInput.inputMode="decimal";
      noteInput.placeholder="Note"; noteInput.min="0"; noteInput.step="0.1";
      noteInput.value = note;

      const coefInput = document.createElement("input");
      coefInput.type="number"; coefInput.inputMode="numeric";
      coefInput.placeholder="Coef"; coefInput.min="1"; coefInput.step="1";
      coefInput.value = coef;

      const delBtn = document.createElement("button");
      delBtn.className="del"; delBtn.textContent="Suppr.";
      delBtn.onclick = () => { wrap.remove(); saveState(); };

      noteInput.addEventListener("input", saveState);
      coefInput.addEventListener("input", saveState);

      wrap.appendChild(noteInput);
      wrap.appendChild(coefInput);
      wrap.appendChild(delBtn);
      rowsSchool.appendChild(wrap);
    }

    function showBadgeSchool(avg, maxNote){
      const ratio = avg/maxNote;
      badgeSchool.style.display = "inline-flex";
      if(ratio < 0.40){ badgeSchool.className="badge b-bad"; badgeSchool.textContent="Niveau : √† remonter"; }
      else if(ratio < 0.50){ badgeSchool.className="badge b-warn"; badgeSchool.textContent="Niveau : fragile"; }
      else if(ratio < 0.60){ badgeSchool.className="badge b-warn"; badgeSchool.textContent="Niveau : correct"; }
      else if(ratio < 0.75){ badgeSchool.className="badge b-ok"; badgeSchool.textContent="Niveau : tr√®s bien"; }
      else { badgeSchool.className="badge b-ok"; badgeSchool.textContent="Niveau : excellent"; }
    }

    function computeSchool(){
      const maxNote = parseFloat(maxNoteEl.value);
      const nextCoef = parseInt(nextCoefEl.value, 10);
      const target = parseFloat(targetEl.value);

      let sum=0, coefSum=0;
      let invalid=false;

      for(const r of [...rowsSchool.querySelectorAll(".row")]){
        const inputs = r.querySelectorAll("input");
        const noteRaw = inputs[0].value.trim();
        const coefRaw = inputs[1].value.trim();
        if(noteRaw==="" && coefRaw==="") continue;

        const note = parseFloat(noteRaw);
        const coef = parseInt(coefRaw, 10);
        if(Number.isNaN(note) || note<0 || note>maxNote || Number.isNaN(coef) || coef<1){ invalid=true; break; }

        sum += note*coef;
        coefSum += coef;
      }

      if(invalid){
        resultSchool.style.display="block";
        resultSchool.innerHTML = `<p style="color:#b00020;font-weight:1000;margin:0;">Erreur : notes (0 √† ${maxNote}) et coefs (>=1).</p>`;
        shareBoxSchool.style.display="none";
        badgeSchool.style.display="none";
        return;
      }
      if(coefSum===0){
        resultSchool.style.display="block";
        resultSchool.innerHTML = `<p style="color:#b00020;font-weight:1000;margin:0;">Rien √† calculer : ajoute au moins une note.</p>`;
        shareBoxSchool.style.display="none";
        badgeSchool.style.display="none";
        return;
      }

      const avg = sum/coefSum;
      const avgR = round2(avg);

      function neededFor(targetScore){
        const x = (targetScore * (coefSum + nextCoef) - sum) / nextCoef;
        return round2(clamp(x, 0, maxNote));
      }
      const needTarget = neededFor(target);
      const needMid = neededFor(maxNote/2);

      showBadgeSchool(avgR, maxNote);

      resultSchool.style.display="block";
      resultSchool.innerHTML = `
        <div class="kpi">
          <div class="kpiBox"><div class="k">Ta moyenne</div><div class="v">${avgR} / ${maxNote}</div></div>
          <div class="kpiBox"><div class="k">Coef total</div><div class="v">${coefSum}</div></div>
        </div>
        <div class="small" style="margin-top:10px;"><b>Prochain contr√¥le</b> (coef ${nextCoef}) :</div>
        <ul class="list">
          <li>Pour atteindre <b>${target} / ${maxNote}</b> : vise <b>${needTarget}</b> / ${maxNote}</li>